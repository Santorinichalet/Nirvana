
<!-- A minimal working example with onclick save -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Test Save</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <button onclick="openPopupManual()">افتح نافذة الحجز اليدوية</button>

  <script>
    function openPopupManual() {
      const existing = document.querySelector("#customPopup");
      if (existing) existing.remove();

      const popup = document.createElement("div");
      popup.id = "customPopup";
      popup.style.position = "fixed";
      popup.style.top = "50%";
      popup.style.left = "50%";
      popup.style.transform = "translate(-50%, -50%)";
      popup.style.background = "white";
      popup.style.padding = "20px";
      popup.style.boxShadow = "0 0 10px rgba(0,0,0,0.3)";
      popup.style.zIndex = "10000";

      popup.innerHTML = `
        <label>نوع الحجز:</label>
        <select id="type"><option value="محجوز">محجوز</option><option value="عربون">عربون</option></select><br>
        <label>المبيت:</label>
        <select id="stay"><option value="مبيت">مبيت</option><option value="بدون مبيت">بدون مبيت</option></select><br>
        <label>المبلغ:</label>
        <input id="amount" type="number"><br>
        <label>العربون:</label>
        <input id="deposit" type="number"><br>
        <label>المتبقي:</label>
        <input id="remaining" type="number" readonly><br>
        <label>طريقة الدفع:</label>
        <select id="payment"><option value="كاش">كاش</option><option value="فيزا">فيزا</option></select><br>
        <label>ملاحظات:</label>
        <textarea id="notes"></textarea><br>
        <button id="saveButton" onclick="saveToFirebase()">💾 حفظ</button>
      `;

      document.body.appendChild(popup);
    }

    function saveToFirebase() {
      alert("🚀 حفظ بدأ");

      const data = {
        type: document.getElementById("type")?.value || "",
        stay: document.getElementById("stay")?.value || "",
        amount: document.getElementById("amount")?.value || "",
        deposit: document.getElementById("deposit")?.value || "",
        remaining: document.getElementById("remaining")?.value || "",
        payment: document.getElementById("payment")?.value || "",
        notes: document.getElementById("notes")?.value || "",
        date: new Date().toISOString()
      };

      try {
        const firebaseConfig = {
          apiKey: "AIzaSyCG17oEvXw-B0MBkZPLaCBYncuIOwgrsOo",
          authDomain: "test-f9621.firebaseapp.com",
          projectId: "test-f9621",
          storageBucket: "test-f9621.appspot.com",
          messagingSenderId: "293849144617",
          appId: "1:293849144617:web:80fd77e8f8da3a98ca2b38",
          measurementId: "G-DM7VPHRHQG"
        };

        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        db.collection("reservations").add(data)
          .then(() => alert("✅ تم حفظ البيانات"))
          .catch((err) => {
            alert("❌ خطأ: " + err.message);
            console.error(err);
          });
      } catch (err) {
        alert("❌ خطأ غير متوقع");
        console.error(err);
      }
    }
  </script>
</body>
</html>
